// Generated by CoffeeScript 2.3.1
(function() {
  $(function() {
    var get4jsons, getJSON;
    // define a helpful func  - it returns promise.
    get4jsons = function(urls) {
      var promises, thelastone;
      promises = urls.map(function(url) {
        return getJSON(url);
      });
      //thelastone = Promise.all promises
      thelastone = Promise.race(promises);
      return thelastone.then(function(json) {
        var dd, dt, i, obj, results, v;
        obj = JSON.parse(json);
        results = [];
        for (i in obj) {
          v = obj[i];
          dt = $('<dt/>', {
            text: i
          });
          dd = $('<dd/>', {
            text: ' ' + v
          });
          $('dl#one').append(dt);
          results.push($('dl#one').append(dd));
        }
        return results;
      }).catch(function(err) {
        return alert(err);
      });
    };
    getJSON = function(url) {
      var promise;
      promise = new Promise(function(resolve, reject) {
        var xhr;
        xhr = new XMLHttpRequest;
        xhr.responseType = 'json';
        xhr.timeout = 2000; //2s
        xhr.onloadend = function(evt) {
          return resolve(evt.target.response);
        };
        xhr.onerror = function(error) {
          return reject(error);
        };
        xhr.open('POST', url, true);
        return xhr.send(null);
      });
      return promise; //getJSON() define end.
    };
    return $('#ajaxbutton').on('click', function(evt) {
      return get4jsons(['/alpha/server-side-data/4', '/alpha/server-side-data/1', '/alpha/server-side-data/2', '/alpha/server-side-data/3']);
    });
  });

}).call(this);
