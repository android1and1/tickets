// Generated by CoffeeScript 2.3.2
(function() {
  $(function() {
    var counter;
    // after window.loaded,create a form -- form0
    counter = 0;
    (new_form(counter++)).insertBefore($('#total-submit'));
    
    // the first form should disable 'delete' button
    $('button.btn-danger').attr('disabled', 1);
    
    // 注册所有类型为RADIO的控件，当点击时禁用/解禁相邻的TEXT控件。
    $('#container').on('click', 'input[type=radio]', function(e) {
      var $input_entry, $input_exit;
      $input_entry = $(this).closest('.form-group').next().find('input');
      $input_exit = $input_entry.parentsUntil('form.form-horizontal').next().find('input');
      switch ($(this).val()) {
        case 'option1':
          $input_entry.removeAttr('disabled');
          return $input_exit.attr('disabled', 1);
        case 'option2':
          $input_entry.attr('disabled', 1);
          return $input_exit.removeAttr('disabled');
        case 'option3':
          $input_exit.removeAttr('disabled');
          return $input_entry.removeAttr('disabled');
      }
    });
    $('#container').on('click', 'button.more', function(e) {
      var $form;
      // create a new form
      $form = new_form(counter);
      $form.insertBefore($('#total-submit'));
      e.preventDefault();
      e.stopPropagation();
      return counter++;
    });
    $('#container').on('click', 'button.btn-danger', function(e) {
      var theform;
      theform = $(this).closest('form');
      theform.remove();
      e.preventDefault();
      return e.stopPropagation();
    });
    return $('#total-submit').on('click', function(e) {
      var array, fd, i, item, len, xhr;
      array = $('form').serializeArray();
      fd = new FormData;
// if multiple forms has same field name,need a map object
//mapobj = {} 
      for (i = 0, len = array.length; i < len; i++) {
        item = array[i];
        //if item.name not in Object.keys(mapobj)
        //  mapobj[item.name]=[] # initialize 
        //mapobj[item.name].push item.value
        fd.append(item.name, item.value);
      }
      
      //for item of mapobj
      //  fd.append item,mapobj[item]
      xhr = new XMLHttpRequest;
      // if no below line,response will be 'text'(string)
      xhr.responseType = 'json';
      xhr.ontimeout = 3000; // 3 secs. 
      xhr.onloadend = function(evt) {
        // createAlertBox() included already
        return window.createAlertBox($('#msg'), JSON.stringify(xhr.response));
      };
      xhr.open('POST', '');
      xhr.send(fd);
      e.preventDefault();
      return e.stopPropagation();
    });
  });

}).call(this);
