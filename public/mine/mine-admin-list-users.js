// Generated by CoffeeScript 2.3.2
(function() {
  $(function() {
    $('.deletebutton').on('click', function(e) {
      var funcButton, id, thisbutton;
      thisbutton = this;
      id = $(this).data('userid');
      // give a chance for ensure.
      funcButton = $('<button/>', {
        'id': 'deleteensure',
        'class': 'btn btn-danger btn-md',
        'text': 'yes,i am sure',
        'data-dismiss': 'modal'
      });
      window.createModal($('body'), {
        'boxid': 'ensurefordelete',
        'funcButton': funcButton,
        'titleText': 'Are You Sure To Delete This Account?',
        'bodyText': 'Becareful do that,if any doubt,click "Cancel" button.'
      });
      $('#ensurefordelete').modal();
      return $('#deleteensure').on('click', function(e) {
        
        // really do ajax.
        return $.ajax({
          url: '/admin/del-user',
          type: 'PUT',
          dataType: 'json',
          data: {
            id: id
          }
        }).done(function(json) {
          var $div, $panel, boxcontent;
          if (json.code === 0) {
            // destory this item from html.
            $panel = $(thisbutton).closest('.panel.panel-default');
            return $panel.remove();
          } else {
            // create an alert-box.
            boxcontent = 'delete failure.reason:' + json.reason;
            $panel = $(thisbutton).closest('.panel.panel-default');
            $div = $('<div/>');
            $panel.before($div);
            return window.createAlertBox($div, boxcontent);
          }
        });
      });
    });
    $('.disablebutton').on('click', function(e) {
      var funcButton, id, thisbutton;
      thisbutton = this;
      id = $(this).data('userid');
      // give a chance for ensure.
      funcButton = $('<button/>', {
        'id': 'disableensure',
        'class': 'btn btn-danger btn-md',
        'text': 'yes,i am sure',
        'data-dismiss': 'modal'
      });
      window.createModal($('body'), {
        'boxid': 'ensurefordisable',
        'funcButton': funcButton,
        'titleText': 'Are You Sure To Disable This Account?',
        'bodyText': 'after disable,user cannot access its account till admin enable it.'
      });
      $('#ensurefordisable').modal();
      return $('#disableensure').on('click', function(e) {
        
        // really do ajax.
        return $.ajax({
          url: '/admin/disable-user',
          type: 'POST',
          dataType: 'json',
          data: {
            id: id
          }
        }).done(function(json) {
          var target;
          if (json.code === 0) {
            $(thisbutton).attr('disabled', '1');
            // remember this:button 'disable' first,next is 'enable'
            $(thisbutton).next().removeAttr('disabled');
            // also,the h3.isActive text need change.
            // $('h3.isActive') is $(thisbutton) parent - '.btn-group' sibling,it is be found via below jQuery travel method.
            return target = $(thisbutton).closest('.btn-group').prevAll().filter('.isActive').html('<small>isActive </small> false');
          } else {
            console.log(json.code);
            return console.log(json.reason);
          }
        }).fail(function(one, two, three) {
          return console.log('status code:', two);
        });
      });
    });
    return $('.enablebutton').on('click', function(e) {
      var funcButton, id, thisbutton;
      thisbutton = this;
      id = $(this).data('userid');
      // give a chance for ensure.
      funcButton = $('<button/>', {
        'id': 'enableensure',
        'class': 'btn btn-danger btn-md',
        'text': 'yes,i am sure',
        'data-dismiss': 'modal'
      });
      window.createModal($('body'), {
        'boxid': 'ensureforenable',
        'funcButton': funcButton,
        'titleText': 'Are You Sure To Enable This Account?',
        'bodyText': 'after executing,user can access its account till admin disable it.'
      });
      $('#ensureforenable').modal();
      // really do ajax.
      return $('#enableensure').on('click', function(e) {
        return $.ajax({
          url: '/admin/enable-user',
          type: 'POST',
          dataType: 'json',
          data: {
            id: id
          }
        }).done(function(json) {
          if (json.code === 0) {
            $(thisbutton).attr('disabled', '1');
            $(thisbutton).prev().removeAttr('disabled');
            return $(thisbutton).closest('.btn-group').prevAll().filter('.isActive').html('<small>isActive </small> true');
          } else {
            console.log(json.code);
            return console.log(json.reason);
          }
        }).fail(function(one, two, three) {
          return console.log('status code:', two);
        });
      });
    });
  });

}).call(this);
